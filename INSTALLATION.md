# Installation Guide

This guide covers installing and setting up **poflow** for your project.

## Quick Start

```bash
# 1. Install poflow
go install github.com/xnilsson/poflow@latest

# 2. Navigate to your project
cd /path/to/your/project

# 3. Initialize configuration
poflow init

# 4. Start using poflow
poflow listempty --language sv
```

## Installation Methods

### Method 1: Go Install (Recommended)

If you have Go installed:

```bash
go install github.com/xnilsson/poflow@latest
```

This installs poflow to your `$GOPATH/bin` directory (usually `~/go/bin`).

Make sure `$GOPATH/bin` is in your `PATH`:

```bash
# Add to your ~/.bashrc, ~/.zshrc, or similar
export PATH="$PATH:$(go env GOPATH)/bin"
```

### Method 2: Download Pre-built Binary

Download the latest release for your platform from the [releases page](https://github.com/xnilsson/poflow/releases).

**macOS (Intel):**
```bash
curl -L https://github.com/xnilsson/poflow/releases/latest/download/poflow-darwin-amd64 -o poflow
chmod +x poflow
sudo mv poflow /usr/local/bin/
```

**macOS (Apple Silicon):**
```bash
curl -L https://github.com/xnilsson/poflow/releases/latest/download/poflow-darwin-arm64 -o poflow
chmod +x poflow
sudo mv poflow /usr/local/bin/
```

**Linux:**
```bash
curl -L https://github.com/xnilsson/poflow/releases/latest/download/poflow-linux-amd64 -o poflow
chmod +x poflow
sudo mv poflow /usr/local/bin/
```

**Windows:**
Download `poflow-windows-amd64.exe` from the releases page and add it to your PATH.

### Method 3: Build from Source

```bash
# Clone the repository
git clone https://github.com/xnilsson/poflow.git
cd poflow

# Build the binary
go build -o poflow .

# Install globally (optional)
sudo mv poflow /usr/local/bin/

# Or install to GOPATH/bin
go install
```

## Verify Installation

Check that poflow is installed correctly:

```bash
poflow version
```

You should see output like:
```
poflow v0.1.0
```

## Project Setup

### Step 1: Initialize Configuration

Navigate to your project directory and run:

```bash
poflow init
```

This creates a `poflow.yml` configuration file with auto-detected settings.

**Example output:**
```
Detected Phoenix/Elixir project
‚úì Created poflow.yml
‚úì Configured gettext_path: priv/gettext

Next steps:
  1. Edit poflow.yml if needed
  2. Run: poflow listempty --language <lang>
  3. See: poflow --help for all commands
```

### Step 2: Verify Configuration

Check the generated `poflow.yml`:

```bash
cat poflow.yml
```

**Example content:**
```yaml
# poflow configuration file
# Generated by poflow init

# Base path for gettext files
# The tool will resolve .po files as: {gettext_path}/{lang}/LC_MESSAGES/default.po
gettext_path: "priv/gettext"
```

### Step 3: Customize (Optional)

Edit `poflow.yml` if the auto-detected path is incorrect:

```yaml
# For Phoenix/Elixir projects
gettext_path: "priv/gettext"

# For Rails projects
gettext_path: "config/locales"

# For custom setup
gettext_path: "translations"
```

### Step 4: Test It

List untranslated entries for a language:

```bash
poflow listempty --language sv --limit 5
```

If you see output, you're ready to go! üéâ

## Configuration Options

### Config File Locations

poflow searches for config files in this order:

1. `./poflow.yml` (current directory) ‚Üê **Recommended**
2. `./poflow.json` (current directory)
3. `~/.config/poflow/config.yml` (user home)

### Config File Format

**YAML (poflow.yml):**
```yaml
gettext_path: "priv/gettext"
```

**JSON (poflow.json):**
```json
{
  "gettext_path": "priv/gettext"
}
```

### Custom Config Location

Use the `--config` flag to specify a config file:

```bash
poflow --config /path/to/custom-config.yml listempty --language sv
```

### Environment Variables

You can also set configuration via environment variables:

```bash
export GETTEXT_PATH="priv/gettext"
poflow listempty --language sv
```

## Project-Specific Setup

### Phoenix/Elixir Projects

```bash
cd your_phoenix_app
poflow init
```

**Expected structure:**
```
your_phoenix_app/
‚îú‚îÄ‚îÄ poflow.yml              # Generated config
‚îî‚îÄ‚îÄ priv/
    ‚îî‚îÄ‚îÄ gettext/
        ‚îú‚îÄ‚îÄ en/
        ‚îÇ   ‚îî‚îÄ‚îÄ LC_MESSAGES/
        ‚îÇ       ‚îî‚îÄ‚îÄ default.po
        ‚îî‚îÄ‚îÄ sv/
            ‚îî‚îÄ‚îÄ LC_MESSAGES/
                ‚îî‚îÄ‚îÄ default.po
```

**poflow.yml:**
```yaml
gettext_path: "priv/gettext"
```

### Rails Projects

```bash
cd your_rails_app
poflow init
```

**Expected structure:**
```
your_rails_app/
‚îú‚îÄ‚îÄ poflow.yml              # Generated config
‚îî‚îÄ‚îÄ config/
    ‚îî‚îÄ‚îÄ locales/
        ‚îú‚îÄ‚îÄ en/
        ‚îÇ   ‚îî‚îÄ‚îÄ LC_MESSAGES/
        ‚îÇ       ‚îî‚îÄ‚îÄ default.po
        ‚îî‚îÄ‚îÄ sv/
            ‚îî‚îÄ‚îÄ LC_MESSAGES/
                ‚îî‚îÄ‚îÄ default.po
```

**poflow.yml:**
```yaml
gettext_path: "config/locales"
```

### Custom Projects

If your project has a non-standard structure:

```bash
poflow init --path path/to/your/translations
```

Or manually create `poflow.yml`:

```yaml
gettext_path: "path/to/your/translations"
```

## Working Without Config Files

You can use poflow without a config file by specifying the `.po` file directly:

```bash
# Direct file path
poflow listempty priv/gettext/sv/LC_MESSAGES/default.po

# From stdin
cat priv/gettext/sv/LC_MESSAGES/default.po | poflow listempty

# Translate with explicit file flag
poflow translate priv/gettext/sv/LC_MESSAGES/default.po -F translations.txt

# Translate using heredoc (no file needed)
poflow translate priv/gettext/sv/LC_MESSAGES/default.po <<EOF
Sign In = Logga in
Sign Out = Logga ut
EOF
```

However, using a config file is recommended for convenience.

## Global Installation (Optional)

To use poflow across all projects without per-project installation:

### Create Global Config

```bash
mkdir -p ~/.config/poflow
cat > ~/.config/poflow/config.yml <<EOF
gettext_path: "priv/gettext"
EOF
```

This config will be used as a fallback when no local `poflow.yml` exists.

### Per-Project Override

Local `poflow.yml` files always take precedence over the global config.

## Troubleshooting

### "command not found: poflow"

**Problem:** Your shell can't find the poflow binary.

**Solution:**

Check if poflow is installed:
```bash
which poflow
```

If not found, ensure `$GOPATH/bin` is in your `PATH`:
```bash
export PATH="$PATH:$(go env GOPATH)/bin"
```

Add this to your `~/.bashrc` or `~/.zshrc` to make it permanent.

### "config file not found"

**Problem:** poflow can't find `poflow.yml`.

**Solution:**

Run `poflow init` in your project directory:
```bash
cd /path/to/your/project
poflow init
```

Or specify the config file explicitly:
```bash
poflow --config /path/to/poflow.yml listempty --language sv
```

### "file not found" with --language flag

**Problem:** poflow can't find the `.po` file at the resolved path.

**Solution:**

1. Check your `poflow.yml` has the correct `gettext_path`:
   ```bash
   cat poflow.yml
   ```

2. Verify the `.po` file exists:
   ```bash
   ls priv/gettext/sv/LC_MESSAGES/default.po
   ```

3. If the structure is different, update `poflow.yml`:
   ```yaml
   gettext_path: "your/actual/path"
   ```

### "permission denied"

**Problem:** Can't execute the poflow binary.

**Solution:**

Make the binary executable:
```bash
chmod +x poflow
```

If installing to `/usr/local/bin`, use `sudo`:
```bash
sudo mv poflow /usr/local/bin/
```

### YAML parsing errors

**Problem:** Config file won't parse.

**Solution:**

Check YAML syntax (indentation matters!):

```yaml
# ‚úÖ Correct
gettext_path: "priv/gettext"

# ‚ùå Wrong (extra spaces, wrong quotes)
gettext_path:  'priv/gettext"
```

Use a YAML validator if needed: https://www.yamllint.com/

## Updating poflow

### Update via Go

```bash
go install github.com/xnilsson/poflow@latest
```

### Update via Binary

Download the latest release and replace your existing binary:

```bash
curl -L https://github.com/xnilsson/poflow/releases/latest/download/poflow-$(uname -s)-$(uname -m) -o poflow
chmod +x poflow
sudo mv poflow /usr/local/bin/
```

### Check Current Version

```bash
poflow version
```

## Uninstallation

### Remove Binary

```bash
# If installed via go install
rm $(which poflow)

# If installed to /usr/local/bin
sudo rm /usr/local/bin/poflow
```

### Remove Config Files

```bash
# Remove project config
rm poflow.yml

# Remove global config
rm -rf ~/.config/poflow
```

## Next Steps

Now that poflow is installed and configured:

1. **Read the [TUTORIAL.md](TUTORIAL.md)** - Learn how to use poflow commands
2. **Read the [README.md](README.md)** - Full documentation and examples
3. **Run `poflow --help`** - See all available commands

## Getting Help

- Run `poflow --help` for command overview
- Run `poflow [command] --help` for detailed help on any command
- File issues at: https://github.com/xnilsson/poflow/issues
- Read the docs: [README.md](README.md)

---

**poflow** - workflow utility for gettext .po files üåä
