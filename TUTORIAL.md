# Tutorial: Getting Started with poflow

This tutorial walks you through common poflow workflows with real examples.

## Prerequisites

Make sure poflow is installed and configured. See [INSTALLATION.md](INSTALLATION.md) if you haven't set it up yet.

```bash
# Verify installation
poflow version
```

## Tutorial Overview

This tutorial covers:
1. [Setting up a project](#1-setting-up-a-project)
2. [Listing untranslated entries](#2-listing-untranslated-entries)
3. [Searching for specific strings](#3-searching-for-strings)
4. [Translating entries](#4-translating-entries)
5. [Changing source text](#5-changing-source-text)
6. [Working with JSON output](#6-working-with-json-output)
7. [LLM-assisted translation workflow](#7-llm-assisted-translation)

## 1. Setting Up a Project

### Initialize poflow in your project

```bash
cd /path/to/your/project
poflow init
```

**Output:**
```
Detected Phoenix/Elixir project
✓ Created poflow.yml
✓ Configured gettext_path: priv/gettext

Next steps:
  1. Edit poflow.yml if needed
  2. Run: poflow listempty --language <lang>
  3. See: poflow --help for all commands
```

### Custom path

If auto-detection doesn't work, specify the path:

```bash
poflow init --path translations
```

### Verify configuration

```bash
cat poflow.yml
```

**Output:**
```yaml
# poflow configuration file
# Generated by poflow init

# Base path for gettext files
gettext_path: "priv/gettext"
```

---

## 2. Listing Untranslated Entries

The `listempty` command shows all entries with empty translations.

### Basic usage

List all untranslated entries in a file:

```bash
poflow listempty test.po
```

**Output:**
```
msgid "Sign In"
msgstr ""

msgid "Profile"
msgstr ""
```

### With language flag (using config)

If you have `poflow.yml` configured:

```bash
poflow listempty --language sv
```

This resolves to `priv/gettext/sv/LC_MESSAGES/default.po` automatically.

### Limit results

Show only the first 5 untranslated entries:

```bash
poflow listempty --limit 5 test.po
```

**Output:**
```
msgid "Sign In"
msgstr ""

msgid "Profile"
msgstr ""
```

### JSON output

Get structured output for programmatic use:

```bash
poflow listempty --json test.po
```

**Output:**
```json
{"msgid":"Sign In","msgstr":""}
{"msgid":"Profile","msgstr":""}
```

### From stdin

Pipe a `.po` file to poflow:

```bash
cat test.po | poflow listempty --limit 1
```

**Output:**
```
msgid "Sign In"
msgstr ""
```

---

## 3. Searching for Strings

### Search by msgid (source text)

#### Plain search (case-insensitive)

```bash
poflow search "Sign" test.po
```

**Output:**
```
msgid "Sign In"
msgstr ""

msgid "Sign Out"
msgstr "Logga ut"
```

#### Regex search

Search for entries starting with "Sign":

```bash
poflow search --re "^Sign" test.po
```

**Output:**
```
msgid "Sign In"
msgstr ""

msgid "Sign Out"
msgstr "Logga ut"
```

Case-insensitive regex:

```bash
poflow search --re "(?i)profile" test.po
```

**Output:**
```
msgid "Profile"
msgstr ""
```

#### Limit results

```bash
poflow search --limit 1 "Sign" test.po
```

**Output:**
```
msgid "Sign In"
msgstr ""
```

#### JSON output

```bash
poflow search --json "Sign" test.po
```

**Output:**
```json
{"msgid":"Sign In","msgstr":""}
{"msgid":"Sign Out","msgstr":"Logga ut"}
```

### Search by msgstr (translation)

#### Plain search

Find entries with Swedish translation containing "Logga":

```bash
poflow searchvalue "Logga" test.po
```

**Output:**
```
msgid "Sign Out"
msgstr "Logga ut"
```

#### Regex search

```bash
poflow searchvalue --re "^Välk" test.po
```

**Output:**
```
msgid "Welcome"
msgstr "Välkommen"
```

#### JSON output

```bash
poflow searchvalue --json "ut" test.po
```

**Output:**
```json
{"msgid":"Sign Out","msgstr":"Logga ut"}
```

---

## 4. Translating Entries

The `translate` command merges translations into a `.po` file.

### Create a translation file

Create `translations.txt` with this format:

```
Sign In = Logga in
Profile = Profil
```

Each line should be: `msgid = msgstr`

### Apply translations

**Method 1: Using translation file (positional argument)**

```bash
poflow translate --language sv translations.txt > updated.po
```

**Method 2: Using --file flag (explicit)**

```bash
poflow translate --language sv -F translations.txt > updated.po
poflow translate --language sv --file translations.txt > updated.po
```

**Method 3: Using heredoc (no file needed)**

```bash
poflow translate --language sv > updated.po <<EOF
Sign In = Logga in
Profile = Profil
EOF
```

**Method 4: Using pipe**

```bash
echo "Sign In = Logga in" | poflow translate --language sv > updated.po
```

**Input file (test.po):**
```
msgid "Sign In"
msgstr ""

msgid "Profile"
msgstr ""
```

**Output (updated.po):**
```
msgid "Sign In"
msgstr "Logga in"

msgid "Profile"
msgstr "Profil"
```

### From stdin with pipe

```bash
echo "Sign In = Logga in" | poflow translate test.po > updated.po
```

### Direct file path

```bash
cat translations.txt | poflow translate test.po > updated.po
```

### Force mode

Continue even if some msgids aren't found:

```bash
poflow translate --force --language sv translations.txt
```

This will show warnings for unmatched entries but continue processing.

---

## 5. Changing Source Text

When you need to change the English source text (msgid), the `edit` command updates it across all language files.

### Why use edit?

When you want to change "Sign In" to "Log In", you need to update:
1. The msgid in Swedish `.po` file
2. The msgid in English `.po` file
3. The msgid in `.pot` template file
4. All source code references

The `edit` command handles steps 1-3 automatically while preserving all translations.

### Preview changes with --dry-run

```bash
poflow edit --dry-run "Sign In" "Log In"
```

**Output:**
```
DRY RUN - No files will be modified

  → priv/gettext/sv/LC_MESSAGES/default.po (1 entries)
  → priv/gettext/en/LC_MESSAGES/default.po (1 entries)
  → priv/gettext/default.pot (1 entries)

Would update 3 file(s) with 3 total entries

Run without --dry-run to apply changes
```

### Apply the changes

```bash
poflow edit "Sign In" "Log In"
```

**Output:**
```
  ✓ priv/gettext/sv/LC_MESSAGES/default.po (1 entries)
  ✓ priv/gettext/en/LC_MESSAGES/default.po (1 entries)
  ✓ priv/gettext/default.pot (1 entries)

Updated 3 file(s) with 3 total entries
```

### What gets preserved

**Before (sv/LC_MESSAGES/default.po):**
```
msgid "Sign In"
msgstr "Logga in"
```

**After:**
```
msgid "Log In"
msgstr "Logga in"
```

The translation (`msgstr`) stays exactly the same! Only the msgid changes.

### When to use edit

✅ **Use edit when:**
- Changing UI text wording
- Fixing typos in source text
- Renaming features across all languages
- Keeping all translations intact

❌ **Don't use edit for:**
- Adding new translations (use `translate` instead)
- Updating existing translations (use `translate` instead)
- Adding new entries (update your source code first)

### Important notes

1. **Update your code too**: After running `edit`, search your codebase for the old text and update code references:
   ```bash
   grep -r "Sign In" lib/ test/
   ```

2. **Exact match only**: The command matches msgid exactly (case-sensitive)

3. **Use git**: Always commit before running `edit` so you can review changes:
   ```bash
   git diff priv/gettext/
   ```

---

## 6. Working with JSON Output

All commands support `--json` for structured output.

### Why JSON?

- **Programmatic processing** with `jq`, Python, etc.
- **LLM integration** - structured input/output
- **Automation** - reliable parsing
- **Complete data** - includes comments, references, etc.

### Extract just msgids

```bash
poflow listempty --json test.po | jq -r .msgid
```

**Output:**
```
Sign In
Profile
```

### Count untranslated entries

```bash
poflow listempty --json test.po | wc -l
```

**Output:**
```
2
```

### Filter by content

Find untranslated entries containing "Sign":

```bash
poflow listempty --json test.po | jq 'select(.msgid | contains("Sign"))'
```

**Output:**
```json
{"msgid":"Sign In","msgstr":""}
```

### Pretty print

```bash
poflow search --json "Welcome" test.po | jq .
```

**Output:**
```json
{
  "msgid": "Welcome",
  "msgstr": "Välkommen"
}
```

---

## 7. LLM-Assisted Translation

poflow is designed to work seamlessly with LLMs for translation.

### Step 1: Export untranslated entries

```bash
poflow listempty --json --limit 10 --language sv > to_translate.json
```

**to_translate.json:**
```json
{"msgid":"Sign In","msgstr":""}
{"msgid":"Profile","msgstr":""}
```

### Step 2: Convert to readable format for LLM

```bash
cat to_translate.json | jq -r .msgid > english.txt
```

**english.txt:**
```
Sign In
Profile
```

### Step 3: Ask LLM to translate

**Prompt:**
```
Please translate these English strings to Swedish.
Output format: English = Swedish (one per line)

[paste contents of english.txt]
```

**LLM Response:**
```
Sign In = Logga in
Profile = Profil
```

### Step 4: Save translations

Save the LLM's response to `translations.txt`:

```
Sign In = Logga in
Profile = Profil
```

### Step 5: Apply translations

**Using translation file:**
```bash
poflow translate --language sv translations.txt > updated.po
poflow translate --language sv -F translations.txt > updated.po
```

**Using heredoc (no file needed):**
```bash
poflow translate --language sv > updated.po <<EOF
Sign In = Logga in
Profile = Profil
EOF
```

**Update in place:**
```bash
poflow translate --language sv translations.txt > temp.po && mv temp.po priv/gettext/sv/LC_MESSAGES/default.po
```

### Complete workflow (with API)

If you have an LLM API available (like `llm` CLI):

```bash
# Extract → Translate → Apply
poflow listempty --json --limit 10 --language sv | \
  jq -r .msgid | \
  llm "Translate to Swedish, format: EN = SV" | \
  poflow translate --language sv > updated.po
```

---

## 8. Real-World Workflows

### Workflow 1: Translate next 20 entries

```bash
# 1. Extract untranslated entries
poflow listempty --json --limit 20 --language sv > batch.json

# 2. Convert to text for LLM
cat batch.json | jq -r '.msgid' > batch.txt

# 3. Manually translate or send to LLM
# (save result to translations.txt)

# 4. Apply translations
poflow translate --language sv translations.txt > updated.po

# 5. Verify
poflow search --json "Sign In" updated.po | jq .
```

### Workflow 2: Check translation coverage

```bash
# Total entries
total=$(poflow search --json --re "." priv/gettext/sv/LC_MESSAGES/default.po | wc -l)

# Untranslated entries
untranslated=$(poflow listempty --json priv/gettext/sv/LC_MESSAGES/default.po | wc -l)

# Calculate coverage
echo "Translation coverage: $(( (total - untranslated) * 100 / total ))%"
```

**Output:**
```
Translation coverage: 60%
```

### Workflow 3: Find and translate login strings

```bash
# 1. Find all login-related strings
poflow search --json --re "(?i)login|sign" --language sv > login_strings.json

# 2. Filter untranslated ones
cat login_strings.json | jq 'select(.msgstr == "")' > login_untranslated.json

# 3. Extract msgids
cat login_untranslated.json | jq -r .msgid > login_to_translate.txt

# 4. Get translations (manually or via LLM)
# (save to login_translations.txt)

# 5. Apply
poflow translate --language sv login_translations.txt > updated.po
```

### Workflow 4: Batch process multiple languages

```bash
# Create translation files for each language
for lang in sv no da fi; do
  echo "Processing $lang..."

  # Extract untranslated
  poflow listempty --json --limit 10 --language $lang > "to_translate_${lang}.json"

  # (Get translations manually or via LLM)
  # (save to translations_${lang}.txt)

  # Apply translations
  poflow translate --language $lang "translations_${lang}.txt" > "updated_${lang}.po"
done
```

---

## 9. Advanced Tips

### Tip 1: Quiet mode

Suppress progress output:

```bash
poflow --quiet listempty --language sv
```

### Tip 2: Custom config location

```bash
poflow --config ../shared-config.yml listempty --language sv
```

### Tip 3: Combining commands

Find and translate specific entries:

```bash
# Find all button-related entries
poflow search --json --re "(?i)button" test.po > buttons.json

# Extract untranslated buttons
cat buttons.json | jq 'select(.msgstr == "")' | jq -r .msgid

# Translate and apply
# (manual step)
poflow translate --language sv button_translations.txt > updated.po
```

### Tip 4: Integration with git

Check what needs translation before committing:

```bash
#!/bin/bash
# check-translations.sh

untranslated=$(poflow listempty --json --language sv | wc -l)

if [ $untranslated -gt 0 ]; then
  echo "⚠️  Warning: $untranslated untranslated entries found"
  echo "Run: poflow listempty --language sv --limit 10"
  exit 1
fi

echo "✓ All entries translated"
```

### Tip 5: Create translation tasks

Generate a markdown checklist:

```bash
echo "# Translation Tasks\n" > tasks.md
poflow listempty --json --language sv | jq -r '"- [ ] " + .msgid' >> tasks.md
cat tasks.md
```

**Output (tasks.md):**
```markdown
# Translation Tasks

- [ ] Sign In
- [ ] Profile
```

---

## Troubleshooting

### Command not found

Make sure poflow is in your PATH:

```bash
which poflow
```

See [INSTALLATION.md](INSTALLATION.md) for setup.

### No output from listempty

**Problem:** `listempty` returns nothing.

**Reason:** All entries are already translated! ✅

Verify:
```bash
poflow search "." test.po | wc -l    # Total entries
poflow listempty test.po | wc -l     # Untranslated entries
```

### File not found with --language flag

**Problem:** `error: file not found`

**Solution:** Check your `poflow.yml` configuration:

```bash
cat poflow.yml
```

Verify the path exists:
```bash
ls priv/gettext/sv/LC_MESSAGES/default.po
```

Update config if needed:
```yaml
gettext_path: "your/actual/path"
```

### Translation not applied

**Problem:** `translate` command doesn't update the entry.

**Reason:** msgid must match exactly (case-sensitive).

**Solution:**
```bash
# Check exact msgid
poflow search --json "Sign" test.po | jq -r .msgid

# Use exact match in translations.txt
echo "Sign In = Logga in" > translations.txt
```

---

## Next Steps

Now that you know the basics:

1. **Explore all commands:** Run `poflow --help`
2. **Read full documentation:** [README.md](README.md)
3. **Set up your project:** [INSTALLATION.md](INSTALLATION.md)
4. **Integrate with your workflow:** Use poflow in scripts, pre-commit hooks, CI/CD

## Getting Help

- Run `poflow [command] --help` for detailed command help
- File issues: https://github.com/xnilsson/poflow/issues
- Read the docs: [README.md](README.md)

---

**poflow** - workflow utility for gettext .po files 🌊

Happy translating! 🌍
